# AGTMUX v0.5 ドキュメント多角的レビュー 統合サマリー

**レビュー日**: 2026-02-13
**レビュー体制**: Opus 4名による並列レビュー
**対象ドキュメント**: agtmux-spec.md, implementation-plan.md, tasks.md, test-catalog.md

---

## レビュアー構成

| # | レビュアー | 観点 | ファイル |
|---|---|---|---|
| 1 | Opus Agent #1 | アーキテクチャ・技術設計 | `review-architecture-2026-02-13.md` |
| 2 | Opus Agent #2 | 整合性・網羅性 | `review-consistency-2026-02-13.md` |
| 3 | Opus Agent #3 | 実現可能性・リスク | `review-feasibility-2026-02-13.md` |
| 4 | Opus Agent #4 | テスト・品質保証 | `review-testing-2026-02-13.md` |

---

## 指摘事項統計

| レビュアー | Critical | Major | Minor | Info | 合計 |
|---|---|---|---|---|---|
| #1 アーキテクチャ | 2 | 13 | 8 | 3 | **26** |
| #2 整合性・網羅性 | 0 | 6 | 14 | 3 | **23** |
| #3 実現可能性・リスク | 6 | 13 | 6 | 0 | **25** |
| #4 テスト・品質保証 | 3 | 10 | 8 | 3 | **24** |
| **合計** | **11** | **42** | **36** | **9** | **98** |

---

## Critical 指摘一覧（全11件）

### 複数レビュアーが共通して指摘した最重要課題

| ID | レビュアー | 概要 | 影響範囲 |
|---|---|---|---|
| #3 F-01 | 実現可能性 | **Claude CLI のフック機構の実在性・安定性が未検証** | プロジェクト全体の前提崩壊リスク |
| #3 F-02 | 実現可能性 | **Codex CLI の notify イベント機構の実在性・安定性が未検証** | 同上 |
| #1 C-01 | アーキテクチャ | **SSH接続ライフサイクル管理が未定義。NFR-1(2秒SLO)達成に直結** | Phase 0-1 blocking |
| #1 C-02 | アーキテクチャ | **コード0行に対する過剰詳細仕様。仕様形骸化リスク** | 全フェーズ |
| #3 C-01 | 実現可能性 | **Phase 0 のスコープが MVP として過大** | Phase 0 |
| #3 D-01 | 実現可能性 | **エージェント CLI のバージョン互換性リスク** | 全アダプター |
| #3 P-01 | 実現可能性 | **最初のユーザー価値提供が Phase 1 完了後と遅すぎる** | プロジェクト存続 |
| #3 O-01 | 実現可能性 | **CI/CD パイプラインが未設計** | テスト全体 |
| #4 C-01 | テスト | **境界値テストの体系的な欠落（12項目以上）** | 状態エンジンの正確性 |
| #4 C-02 | テスト | **tmux/SSH 依存のCI実行環境に関する考慮が全面的に不足** | テスト自動化 |
| #4 C-03 | テスト | **テスト技術スタック（言語/フレームワーク/CI）が未定義** | テスト全体 |

---

## 横断分析：複数レビュアーの共通指摘テーマ

### Theme 1: 技術PoC未実施（#3 F-01, F-02, D-01）
Claude CLI / Codex CLI のフック・イベント機構が実際に利用可能か未確認。プロジェクト全体の前提条件であるにもかかわらず、技術検証が行われていない。

**統一推奨**: Phase 0 開始前に 1-2日の PoC を実施し、各 CLI のフック機構の実在性・安定性を確認する。

### Theme 2: daemon 基盤設計の欠如（#1 M-01, M-18 / #2 6-2 / #3 E-01, O-02）
- API トランスポート層が未決定（HTTP? Unix Socket? gRPC?）
- デーモンの起動・停止・クラッシュ回復のライフサイクルが未定義
- ログ・オブザーバビリティ戦略がない

**統一推奨**: daemon の基本アーキテクチャ（トランスポート、ライフサイクル、ログ）を Phase 0 の Entry Criteria として定義する。

### Theme 3: Phase 0 の過大スコープとMVP遅延（#1 C-02 / #3 C-01, P-01, P-02）
- Phase 0 だけで 11タスク・17テスト
- Phase 0+1 で 23タスク完了までユーザー価値ゼロ
- 仕様が過剰に詳細で、実装フィードバックの余地がない

**統一推奨**: Phase 0 を 0a/0b に分割し、「単一ターゲット + Claude + ポーリングベース状態表示」のスケルトン MVP を 2-3日で構築する。

### Theme 4: adapter registry の Phase 配置問題（#1 M-13 / #2 1-4, 1-5, 2-1）
- adapter registry (TASK-035) が Phase 2 配置だが、Phase 1 の Claude/Codex adapter 実装時に必要
- `adapters` テーブルの作成タイミングも曖昧

**統一推奨**: adapter registry の最小実装を Phase 0 または Phase 1 に前倒しする。

### Theme 5: SSH接続管理（#1 C-01, M-07 / #3 F-04, E-02）
- SSH 接続のライフサイクル（確立・維持・再接続）が未定義
- 60ペインの2秒ポーリングが SSH 経由で現実的か疑問
- target health の状態遷移条件が未定義

**統一推奨**: SSH ControlMaster/ControlPersist の利用を前提とし、TargetExecutor の SSH 接続管理戦略を spec に追加する。

### Theme 6: テスト基盤の不備（#3 O-01 / #4 C-02, C-03, M-01）
- 技術スタック未確定のためテストフレームワーク選定不可
- CI 環境での tmux/SSH テスト実行方法が未定義
- Unit テストが全体の 3.8% しかない（テストピラミッド違反）

**統一推奨**: Phase 0 最初のタスクとして技術スタック確定 + CI 基盤構築を行う。Unit テストケースを 15-20件追加する。

### Theme 7: ドキュメント間の不整合（#1 M-16 / #2 1-2, 1-3, 5-1 / #4 M-15）
- Phase 0 Exit Criteria と test-catalog の Phase 0 Gate Bundle が不一致
- TC-018 のフェーズゲート(Phase 1) とタスクフェーズ(1.5) が矛盾
- implementation-plan のゲート参照が累積バンドルを暗黙前提

**統一推奨**: 全ドキュメントのゲートバンドル参照を統一し、authoritative source を明確化する。

### Theme 8: セキュリティ考慮の不足（#1 M-09, M-10, M-11 / #4 M-14）
- send コマンドのインジェクションリスク
- SSH 認証情報の取り扱い方針不足
- daemon API の認証・認可が未定義
- セキュリティテストが 2件しかない

**統一推奨**: send コマンドのサニタイズ戦略を spec に追記。SSH credential / インジェクション攻撃のテストを追加する。

---

## Phase 0 開始前に解決すべき最優先アクション（推奨順）

| 優先度 | アクション | 根拠 | 所要時間（見込み） |
|---|---|---|---|
| **P0** | Claude CLI / Codex CLI フック機構の PoC | プロジェクト全体の前提確認 | 1-2日 |
| **P0** | 技術スタック確定（言語, FW, CI） | 全実装・テストの基盤 | 0.5-1日 |
| **P0** | daemon API トランスポート層の決定 | TASK-031 に直結 | 0.5日 |
| **P0** | SSH 接続管理戦略の策定 | NFR-1 達成の前提 | 0.5-1日 |
| **P1** | Phase 0 の 0a/0b 分割 + スケルトン MVP 定義 | ユーザー価値の早期確認 | 0.5日 |
| **P1** | State Engine / Reconciler の責務境界明確化 | 実装時のデッドロック防止 | 0.5日 |
| **P1** | daemon ライフサイクル管理の定義 | 仕様の欠如部分補完 | 0.5日 |
| **P1** | Unit テストケース 15-20件の洗い出し・追加 | テストピラミッド是正 | 0.5日 |
| **P2** | adapter registry の Phase 前倒し検討 | リファクタコスト回避 | 0.5日 |
| **P2** | ドキュメント間のゲートバンドル整合性修正 | 混乱回避 | 0.5日 |
| **P2** | 境界値テスト 5-6件の追加 | 状態エンジンの正確性保証 | 0.5日 |
| **P2** | セキュリティ考慮（send サニタイズ等）の追記 | インジェクション防止 | 0.5日 |

---

## 全体所見

### 強み
- FR/NFR → タスク → テストの三方向トレーサビリティが確立されている
- フェーズゲートの累積構造による回帰テスト保証が優れている
- fail-closed 原則の一貫した適用
- Property Test の採用、Contract Test によるスキーマ回帰防止

### 最大のリスク
**「設計の成熟度」と「実装準備度」のギャップ**。仕様は分散システム級の堅牢性を要求しているが、対象はシングルユーザーの開発者用 CLI ツールであり、設計の複雑さとユースケースの単純さに大きな乖離がある。コード0行の段階で 13テーブル・12エラーコード・BNF文法・Action Snapshot 等の詳細仕様を固定することは、実装過程での仕様形骸化リスクを高める。

### 推奨アプローチ
1. **PoC First**: Claude/Codex CLI のフック機構を 1-2日で検証
2. **Skeleton MVP**: 最小動作版を 2-3日で構築し、ユーザー価値を早期確認
3. **Iterative Spec**: 実装からの学びで仕様を段階的に洗練（仕様先行ウォーターフォールの回避）
4. **Test Pyramid Fix**: Unit テスト層を厚くし、E2E 依存を減らす
